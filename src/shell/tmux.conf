#  ----------------------------------------------------------------------------
# | General Settings                                                           |
#  ----------------------------------------------------------------------------

# Set default command to fish shell
set -g default-command /opt/homebrew/bin/fish

# Make window index start at 1
set -g base-index 1

# Make pane index start at 1
setw -g pane-base-index 1

# Renumber when closing window
set -g renumber-windows on

# Disable mouse
set -g mouse off


#  ----------------------------------------------------------------------------
# | Key Mappings                                                               |
#  ----------------------------------------------------------------------------

# Change the key combination for the PREFIX key to `ctrl-a`
set -g prefix C-a
unbind-key C-b
bind-key C-b send-prefix

# Remap the copy & paste keys to work as in vim
unbind [
bind Escape copy-mode
unbind p
bind p paste-buffer
bind-key -T copy-mode-vi "v" send-keys -X begin-selection
bind-key -T copy-mode-vi "y" send-keys -X copy-selection

# Open lazygit in a popup window in the current pane's directory
bind -r g display-popup -d '#{pane_current_path}' -w80% -h80% -E lazygit

# Open Claude in a persistent, path-scoped session via popup
# Reuses an existing session if one already exists for the current path
bind -r y run-shell '\
  SESSION="claude-$(echo #{pane_current_path} | md5sum | cut -c1-8)"; \
  tmux has-session -t "$SESSION" 2>/dev/null || \
  tmux new-session -d -s "$SESSION" -c "#{pane_current_path}" "claude"; \
  tmux display-popup -w80% -h80% -E "tmux attach-session -t $SESSION"'

#  ----------------------------------------------------------------------------
# | Visual Styling                                                             |
#  ----------------------------------------------------------------------------

# RGB 24-bit color support
set -ag terminal-overrides ",xterm-256color:RGB"

# PowerKit plugin
set -g @powerkit_theme "moonlight"
set -g @powerkit_theme_variant "default"
set -g @powerkit_plugins "externalip,netspeed,weather,nowplaying,datetime"

set -g @powerkit_edge_separator_style "same"
set -g @powerkit_elements_spacing "both"
set -g @powerkit_separator_style "slant"
set -g @powerkit_status_position "bottom"

set -g @powerkit_pane_border_lines "heavy"
set -g @powerkit_pane_border_unified "true"
set -g @powerkit_pane_border_color "pane-border-inactive"
set -g @powerkit_pane_border_status "top"
set -g @powerkit_pane_border_format "{active}"


#  ----------------------------------------------------------------------------
# | Plugins                                                                    |
#  ----------------------------------------------------------------------------

set -g @plugin 'fabioluciano/tmux-powerkit'
set -g @plugin "tmux-plugins/tmux-pain-control"
set -g @plugin "tmux-plugins/tmux-sensible"
set -g @plugin "tmux-plugins/tpm"

# Bootstrap tmux plugin manager (TPM)
if "test ! -d ~/.tmux/plugins/tpm" \
   "run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm'"

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run "~/.tmux/plugins/tpm/tpm"

# Override popup background to match pane background (after plugins so it wins)
set -g popup-style 'bg=#212337'
set -g popup-border-style 'fg=#82aaff,bg=#212337'
